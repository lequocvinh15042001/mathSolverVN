{"ast":null,"code":"/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","map":{"version":3,"names":["ObliviousSet","fillOptionsWithDefaults","sleep","randomToken","microSeconds","micro","isNode","KEY_PREFIX","type","getLocalStorage","localStorage","window","e","storageKey","channelName","postMessage","channelState","messageJson","Promise","res","then","key","writeObj","token","time","Date","getTime","data","uuid","value","JSON","stringify","setItem","ev","document","createEvent","initEvent","newValue","dispatchEvent","addStorageEventListener","fn","listener","parse","addEventListener","removeStorageEventListener","removeEventListener","create","options","canBeUsed","Error","eMIs","localstorage","removeTimeout","state","msgObj","messagesCallback","has","messagesCallbackTime","add","close","onMessage","ls","removeItem","averageResponseTime","defaultTime","userAgent","navigator","toLowerCase","includes"],"sources":["/Users/lequocvinh/MathSolver/mathSolverVN/node_modules/broadcast-channel/dist/es/methods/localstorage.js"],"sourcesContent":["/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}