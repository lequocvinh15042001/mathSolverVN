{"ast":null,"code":"import { sleep, randomToken } from './util.js';\nimport unload from 'unload';\n\nvar LeaderElection = function LeaderElection(channel, options) {\n  this._channel = channel;\n  this._options = options;\n  this.isLeader = false;\n  this.isDead = false;\n  this.token = randomToken();\n  this._isApl = false; // _isApplying\n\n  this._reApply = false; // things to clean up\n\n  this._unl = []; // _unloads\n\n  this._lstns = []; // _listeners\n\n  this._invs = []; // _intervals\n\n  this._dpL = function () {}; // onduplicate listener\n\n\n  this._dpLC = false; // true when onduplicate called\n};\n\nLeaderElection.prototype = {\n  applyOnce: function applyOnce() {\n    var _this = this;\n\n    if (this.isLeader) return Promise.resolve(false);\n    if (this.isDead) return Promise.resolve(false); // do nothing if already running\n\n    if (this._isApl) {\n      this._reApply = true;\n      return Promise.resolve(false);\n    }\n\n    this._isApl = true;\n    var stopCriteria = false;\n    var recieved = [];\n\n    var handleMessage = function handleMessage(msg) {\n      if (msg.context === 'leader' && msg.token != _this.token) {\n        recieved.push(msg);\n\n        if (msg.action === 'apply') {\n          // other is applying\n          if (msg.token > _this.token) {\n            // other has higher token, stop applying\n            stopCriteria = true;\n          }\n        }\n\n        if (msg.action === 'tell') {\n          // other is already leader\n          stopCriteria = true;\n        }\n      }\n    };\n\n    this._channel.addEventListener('internal', handleMessage);\n\n    var ret = _sendMessage(this, 'apply') // send out that this one is applying\n    .then(function () {\n      return sleep(_this._options.responseTime);\n    }) // let others time to respond\n    .then(function () {\n      if (stopCriteria) return Promise.reject(new Error());else return _sendMessage(_this, 'apply');\n    }).then(function () {\n      return sleep(_this._options.responseTime);\n    }) // let others time to respond\n    .then(function () {\n      if (stopCriteria) return Promise.reject(new Error());else return _sendMessage(_this);\n    }).then(function () {\n      return beLeader(_this);\n    }) // no one disagreed -> this one is now leader\n    .then(function () {\n      return true;\n    })[\"catch\"](function () {\n      return false;\n    }) // apply not successfull\n    .then(function (success) {\n      _this._channel.removeEventListener('internal', handleMessage);\n\n      _this._isApl = false;\n\n      if (!success && _this._reApply) {\n        _this._reApply = false;\n        return _this.applyOnce();\n      } else return success;\n    });\n\n    return ret;\n  },\n  awaitLeadership: function awaitLeadership() {\n    if (\n    /* _awaitLeadershipPromise */\n    !this._aLP) {\n      this._aLP = _awaitLeadershipOnce(this);\n    }\n\n    return this._aLP;\n  },\n\n  set onduplicate(fn) {\n    this._dpL = fn;\n  },\n\n  die: function die() {\n    var _this2 = this;\n\n    if (this.isDead) return;\n    this.isDead = true;\n\n    this._lstns.forEach(function (listener) {\n      return _this2._channel.removeEventListener('internal', listener);\n    });\n\n    this._invs.forEach(function (interval) {\n      return clearInterval(interval);\n    });\n\n    this._unl.forEach(function (uFn) {\n      uFn.remove();\n    });\n\n    return _sendMessage(this, 'death');\n  }\n};\n\nfunction _awaitLeadershipOnce(leaderElector) {\n  if (leaderElector.isLeader) return Promise.resolve();\n  return new Promise(function (res) {\n    var resolved = false;\n\n    function finish() {\n      if (resolved) {\n        return;\n      }\n\n      resolved = true;\n      clearInterval(interval);\n\n      leaderElector._channel.removeEventListener('internal', whenDeathListener);\n\n      res(true);\n    } // try once now\n\n\n    leaderElector.applyOnce().then(function () {\n      if (leaderElector.isLeader) {\n        finish();\n      }\n    }); // try on fallbackInterval\n\n    var interval = setInterval(function () {\n      leaderElector.applyOnce().then(function () {\n        if (leaderElector.isLeader) {\n          finish();\n        }\n      });\n    }, leaderElector._options.fallbackInterval);\n\n    leaderElector._invs.push(interval); // try when other leader dies\n\n\n    var whenDeathListener = function whenDeathListener(msg) {\n      if (msg.context === 'leader' && msg.action === 'death') {\n        leaderElector.applyOnce().then(function () {\n          if (leaderElector.isLeader) finish();\n        });\n      }\n    };\n\n    leaderElector._channel.addEventListener('internal', whenDeathListener);\n\n    leaderElector._lstns.push(whenDeathListener);\n  });\n}\n/**\n * sends and internal message over the broadcast-channel\n */\n\n\nfunction _sendMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector._channel.postInternal(msgJson);\n}\n\nexport function beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  var unloadFn = unload.add(function () {\n    return leaderElector.die();\n  });\n\n  leaderElector._unl.push(unloadFn);\n\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      _sendMessage(leaderElector, 'tell');\n    }\n\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n\n\n      _sendMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n\n    }\n  };\n\n  leaderElector._channel.addEventListener('internal', isLeaderListener);\n\n  leaderElector._lstns.push(isLeaderListener);\n\n  return _sendMessage(leaderElector, 'tell');\n}\n\nfunction fillOptionsWithDefaults(options, channel) {\n  if (!options) options = {};\n  options = JSON.parse(JSON.stringify(options));\n\n  if (!options.fallbackInterval) {\n    options.fallbackInterval = 3000;\n  }\n\n  if (!options.responseTime) {\n    options.responseTime = channel.method.averageResponseTime(channel.options);\n  }\n\n  return options;\n}\n\nexport function createLeaderElection(channel, options) {\n  if (channel._leaderElector) {\n    throw new Error('BroadcastChannel already has a leader-elector');\n  }\n\n  options = fillOptionsWithDefaults(options, channel);\n  var elector = new LeaderElection(channel, options);\n\n  channel._befC.push(function () {\n    return elector.die();\n  });\n\n  channel._leaderElector = elector;\n  return elector;\n}","map":{"version":3,"names":["sleep","randomToken","unload","LeaderElection","channel","options","_channel","_options","isLeader","isDead","token","_isApl","_reApply","_unl","_lstns","_invs","_dpL","_dpLC","prototype","applyOnce","_this","Promise","resolve","stopCriteria","recieved","handleMessage","msg","context","push","action","addEventListener","ret","_sendMessage","then","responseTime","reject","Error","beLeader","success","removeEventListener","awaitLeadership","_aLP","_awaitLeadershipOnce","onduplicate","fn","die","_this2","forEach","listener","interval","clearInterval","uFn","remove","leaderElector","res","resolved","finish","whenDeathListener","setInterval","fallbackInterval","msgJson","postInternal","unloadFn","add","isLeaderListener","fillOptionsWithDefaults","JSON","parse","stringify","method","averageResponseTime","createLeaderElection","_leaderElector","elector","_befC"],"sources":["/Users/lequocvinh/MathSolver/mathSolverVN/node_modules/broadcast-channel/dist/es/leader-election.js"],"sourcesContent":["import { sleep, randomToken } from './util.js';\nimport unload from 'unload';\n\nvar LeaderElection = function LeaderElection(channel, options) {\n  this._channel = channel;\n  this._options = options;\n  this.isLeader = false;\n  this.isDead = false;\n  this.token = randomToken();\n  this._isApl = false; // _isApplying\n\n  this._reApply = false; // things to clean up\n\n  this._unl = []; // _unloads\n\n  this._lstns = []; // _listeners\n\n  this._invs = []; // _intervals\n\n  this._dpL = function () {}; // onduplicate listener\n\n\n  this._dpLC = false; // true when onduplicate called\n};\n\nLeaderElection.prototype = {\n  applyOnce: function applyOnce() {\n    var _this = this;\n\n    if (this.isLeader) return Promise.resolve(false);\n    if (this.isDead) return Promise.resolve(false); // do nothing if already running\n\n    if (this._isApl) {\n      this._reApply = true;\n      return Promise.resolve(false);\n    }\n\n    this._isApl = true;\n    var stopCriteria = false;\n    var recieved = [];\n\n    var handleMessage = function handleMessage(msg) {\n      if (msg.context === 'leader' && msg.token != _this.token) {\n        recieved.push(msg);\n\n        if (msg.action === 'apply') {\n          // other is applying\n          if (msg.token > _this.token) {\n            // other has higher token, stop applying\n            stopCriteria = true;\n          }\n        }\n\n        if (msg.action === 'tell') {\n          // other is already leader\n          stopCriteria = true;\n        }\n      }\n    };\n\n    this._channel.addEventListener('internal', handleMessage);\n\n    var ret = _sendMessage(this, 'apply') // send out that this one is applying\n    .then(function () {\n      return sleep(_this._options.responseTime);\n    }) // let others time to respond\n    .then(function () {\n      if (stopCriteria) return Promise.reject(new Error());else return _sendMessage(_this, 'apply');\n    }).then(function () {\n      return sleep(_this._options.responseTime);\n    }) // let others time to respond\n    .then(function () {\n      if (stopCriteria) return Promise.reject(new Error());else return _sendMessage(_this);\n    }).then(function () {\n      return beLeader(_this);\n    }) // no one disagreed -> this one is now leader\n    .then(function () {\n      return true;\n    })[\"catch\"](function () {\n      return false;\n    }) // apply not successfull\n    .then(function (success) {\n      _this._channel.removeEventListener('internal', handleMessage);\n\n      _this._isApl = false;\n\n      if (!success && _this._reApply) {\n        _this._reApply = false;\n        return _this.applyOnce();\n      } else return success;\n    });\n\n    return ret;\n  },\n  awaitLeadership: function awaitLeadership() {\n    if (\n    /* _awaitLeadershipPromise */\n    !this._aLP) {\n      this._aLP = _awaitLeadershipOnce(this);\n    }\n\n    return this._aLP;\n  },\n\n  set onduplicate(fn) {\n    this._dpL = fn;\n  },\n\n  die: function die() {\n    var _this2 = this;\n\n    if (this.isDead) return;\n    this.isDead = true;\n\n    this._lstns.forEach(function (listener) {\n      return _this2._channel.removeEventListener('internal', listener);\n    });\n\n    this._invs.forEach(function (interval) {\n      return clearInterval(interval);\n    });\n\n    this._unl.forEach(function (uFn) {\n      uFn.remove();\n    });\n\n    return _sendMessage(this, 'death');\n  }\n};\n\nfunction _awaitLeadershipOnce(leaderElector) {\n  if (leaderElector.isLeader) return Promise.resolve();\n  return new Promise(function (res) {\n    var resolved = false;\n\n    function finish() {\n      if (resolved) {\n        return;\n      }\n\n      resolved = true;\n      clearInterval(interval);\n\n      leaderElector._channel.removeEventListener('internal', whenDeathListener);\n\n      res(true);\n    } // try once now\n\n\n    leaderElector.applyOnce().then(function () {\n      if (leaderElector.isLeader) {\n        finish();\n      }\n    }); // try on fallbackInterval\n\n    var interval = setInterval(function () {\n      leaderElector.applyOnce().then(function () {\n        if (leaderElector.isLeader) {\n          finish();\n        }\n      });\n    }, leaderElector._options.fallbackInterval);\n\n    leaderElector._invs.push(interval); // try when other leader dies\n\n\n    var whenDeathListener = function whenDeathListener(msg) {\n      if (msg.context === 'leader' && msg.action === 'death') {\n        leaderElector.applyOnce().then(function () {\n          if (leaderElector.isLeader) finish();\n        });\n      }\n    };\n\n    leaderElector._channel.addEventListener('internal', whenDeathListener);\n\n    leaderElector._lstns.push(whenDeathListener);\n  });\n}\n/**\n * sends and internal message over the broadcast-channel\n */\n\n\nfunction _sendMessage(leaderElector, action) {\n  var msgJson = {\n    context: 'leader',\n    action: action,\n    token: leaderElector.token\n  };\n  return leaderElector._channel.postInternal(msgJson);\n}\n\nexport function beLeader(leaderElector) {\n  leaderElector.isLeader = true;\n  var unloadFn = unload.add(function () {\n    return leaderElector.die();\n  });\n\n  leaderElector._unl.push(unloadFn);\n\n  var isLeaderListener = function isLeaderListener(msg) {\n    if (msg.context === 'leader' && msg.action === 'apply') {\n      _sendMessage(leaderElector, 'tell');\n    }\n\n    if (msg.context === 'leader' && msg.action === 'tell' && !leaderElector._dpLC) {\n      /**\n       * another instance is also leader!\n       * This can happen on rare events\n       * like when the CPU is at 100% for long time\n       * or the tabs are open very long and the browser throttles them.\n       * @link https://github.com/pubkey/broadcast-channel/issues/414\n       * @link https://github.com/pubkey/broadcast-channel/issues/385\n       */\n      leaderElector._dpLC = true;\n\n      leaderElector._dpL(); // message the lib user so the app can handle the problem\n\n\n      _sendMessage(leaderElector, 'tell'); // ensure other leader also knows the problem\n\n    }\n  };\n\n  leaderElector._channel.addEventListener('internal', isLeaderListener);\n\n  leaderElector._lstns.push(isLeaderListener);\n\n  return _sendMessage(leaderElector, 'tell');\n}\n\nfunction fillOptionsWithDefaults(options, channel) {\n  if (!options) options = {};\n  options = JSON.parse(JSON.stringify(options));\n\n  if (!options.fallbackInterval) {\n    options.fallbackInterval = 3000;\n  }\n\n  if (!options.responseTime) {\n    options.responseTime = channel.method.averageResponseTime(channel.options);\n  }\n\n  return options;\n}\n\nexport function createLeaderElection(channel, options) {\n  if (channel._leaderElector) {\n    throw new Error('BroadcastChannel already has a leader-elector');\n  }\n\n  options = fillOptionsWithDefaults(options, channel);\n  var elector = new LeaderElection(channel, options);\n\n  channel._befC.push(function () {\n    return elector.die();\n  });\n\n  channel._leaderElector = elector;\n  return elector;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}